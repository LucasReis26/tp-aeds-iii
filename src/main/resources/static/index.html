<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FilmBox - Painel de Testes da API</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color-darkest: #141414;
            --bg-color-dark: #1d1d1f;
            --primary-red: #e50914;
            --text-color: #f5f5f7;
            --text-muted: #8e8e93;
            --border-color: #3a3a3c;
            --border-radius: 8px;
            --success-color: #34c759;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 2rem;
            background-color: var(--bg-color-darkest);
            color: var(--text-color);
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-red);
            text-shadow: 0 0 10px rgba(229, 9, 20, 0.5);
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }

        .entity-column {
            background-color: var(--bg-color-dark);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .operation {
            border-top: 1px solid var(--border-color);
            padding-top: 1.5rem;
            margin-top: 1.5rem;
        }

        .entity-column .operation:first-of-type {
            border-top: none;
            padding-top: 0;
            margin-top: 0;
        }

        h2 {
            margin-top: 0;
            color: var(--primary-red);
            border-bottom: 1px solid var(--primary-red);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }

        h3 {
            font-size: 1.1em;
            color: var(--text-color);
            margin-bottom: 1rem;
        }

        .badge-rsa {
            background-color: #e50914;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            vertical-align: middle;
            margin-left: 8px;
        }

        input,
        button {
            width: 100%;
            box-sizing: border-box;
            padding: 12px 15px;
            margin-bottom: 1rem;
            font-size: 1rem;
            border-radius: var(--border-radius);
            background-color: #3a3a3c;
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
            border: 1px solid #555;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        input:focus {
            outline: none;
            border-color: var(--primary-red);
            box-shadow: 0 0 0 2px rgba(229, 9, 20, 0.4);
        }

        input::placeholder {
            color: var(--text-muted);
        }

        button {
            background-color: var(--primary-red);
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: background-color 0.2s ease-in-out;
        }

        button:hover {
            background-color: #b20710;
        }

        pre {
            background-color: #1c1c1e;
            padding: 1rem;
            border-radius: var(--border-radius);
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'SF Mono', 'Fira Code', 'Fira Mono', 'Roboto Mono', monospace;
            font-size: 0.85rem;
            border: 1px solid var(--border-color);
            max-height: 300px;
            overflow-y: auto;
        }

        pre.success {
            border-left: 4px solid var(--success-color);
            color: #d0d0d0;
        }

        pre.error {
            border-left: 4px solid var(--primary-red);
            color: #ffbaba;
        }
    </style>
</head>

<body>

    <header class="header">
        <h1>FilmBox API</h1>
        <p>Painel de Testes e Interação com a Base de Dados</p>
    </header>

    <main class="grid-container">

        <section class="entity-column">
            <h2>Usuários <span class="badge-rsa">RSA SECURE</span></h2>
            <div class="operation">
                <h3>Criar Usuário</h3>
                <input id="user-username" placeholder="Nome de usuário (ex: 'alice')">
                <input id="user-description" placeholder="Descrição (ex: 'Gosta de drama')">
                <input id="user-password" type="password" placeholder="Senha (será criptografada no DB)">
                <button
                    onclick="handleApiCall('user-create-result', 'POST', '/users', { username: getValue('user-username'), description: getValue('user-description'), password: getValue('user-password') })">Criar</button>
                <pre id="user-create-result"></pre>
            </div>
            <div class="operation">
                <h3>Gerenciar Usuário por ID</h3>
                <input id="user-id" type="number" placeholder="ID do Usuário">
                <button onclick="handleApiCall('user-manage-result', 'GET', `/users/${getValue('user-id')}`)">Buscar
                    (Descriptografa Auto)</button>
                <input id="user-new-username" placeholder="Novo nome de usuário (para alterar)">
                <input id="user-new-description" placeholder="Nova descrição (para alterar)">
                <button
                    onclick="handleApiCall('user-manage-result', 'PUT', `/users/${getValue('user-id')}`, { username: getValue('user-new-username'), description: getValue('user-new-description') })">Alterar</button>
                <button
                    onclick="handleApiCall('user-manage-result', 'DELETE', `/users/${getValue('user-id')}`)">Excluir</button>
                <pre id="user-manage-result"></pre>
            </div>
            <div class="operation">
                <h3>Listar Todos os Usuários</h3>
                <button onclick="handleApiCall('user-list-result', 'GET', '/users')">Listar Todos</button>
                <pre id="user-list-result"></pre>
            </div>
        </section>

        <section class="entity-column">
            <h2>Filmes</h2>
            <div class="operation">
                <h3>Criar Filme</h3>
                <input id="filme-title" placeholder="Título">
                <input id="filme-releaseDate" type="date">
                <input id="filme-score" type="number" placeholder="Score (0-100)">
                <input id="filme-duration" type="number" placeholder="Duração (minutos)">
                <input id="filme-rating" type="number" placeholder="Classificação Indicativa">
                <input id="filme-directors" placeholder="Diretores (separados por vírgula)">
                <input id="filme-actors" placeholder="Atores (separados por vírgula)">
                <button onclick="criarFilme()">Criar</button>
                <pre id="filme-create-result"></pre>
            </div>
            <div class="operation">
                <h3>Buscar / Excluir Filmes</h3>
                <input id="filme-id" type="number" placeholder="ID do Filme para buscar/excluir">
                <button onclick="handleApiCall('filme-search-result', 'GET', `/filmes/${getValue('filme-id')}`)">Buscar
                    por ID</button>
                <button
                    onclick="handleApiCall('filme-search-result', 'DELETE', `/filmes/${getValue('filme-id')}`)">Excluir
                    por ID</button>
                <input id="filme-search-title" placeholder="Termo de busca no Título">
                <button
                    onclick="handleApiCall('filme-search-result', 'GET', `/filmes/buscar?titulo=${getValue('filme-search-title')}`)">Buscar
                    por Título</button>
                <button onclick="handleApiCall('filme-search-result', 'GET', '/filmes')">Listar Todos</button>
                <pre id="filme-search-result"></pre>
            </div>
        </section>

        <section class="entity-column">
            <h2>Reviews</h2>
            <div class="operation">
                <h3>Criar Review</h3>
                <input id="review-userId" type="number" placeholder="ID do Usuário avaliador">
                <input id="review-filmeId" type="number" placeholder="ID do Filme avaliado">
                <input id="review-nota" type="number" step="0.1" placeholder="Nota (0.0 - 10.0)">
                <input id="review-comentario" placeholder="Comentário">
                <button onclick="criarReview()">Criar</button>
                <pre id="review-create-result"></pre>
            </div>
            <div class="operation">
                <h3>Atualizar Review</h3>
                <input id="review-update-id" type="number" placeholder="ID da Review a ser alterada">
                <input id="review-update-userId" type="number" placeholder="Seu ID de Usuário (para permissão)">
                <input id="review-update-nota" type="number" step="0.1" placeholder="Nova Nota">
                <input id="review-update-comentario" placeholder="Novo Comentário">
                <button onclick="atualizarReview()">Atualizar</button>
                <pre id="review-update-result"></pre>
            </div>
            <div class="operation">
                <h3>Buscar / Excluir / Listar Reviews</h3>
                <input id="review-id" type="number" placeholder="ID da Review para buscar/excluir">
                <button onclick="handleApiCall('review-list-result', 'GET', `/reviews/${getValue('review-id')}`)">Buscar
                    por ID</button>
                <button
                    onclick="handleApiCall('review-list-result', 'DELETE', `/reviews/${getValue('review-id')}`)">Excluir
                    por ID</button>
                <input id="review-list-userId" type="number" placeholder="ID do Usuário para listar">
                <button
                    onclick="handleApiCall('review-list-result', 'GET', `/reviews/user/${getValue('review-list-userId')}`)">Listar
                    por Usuário</button>
                <input id="review-list-filmeId" type="number" placeholder="ID do Filme para listar">
                <button
                    onclick="handleApiCall('review-list-result', 'GET', `/reviews/filme/${getValue('review-list-filmeId')}`)">Listar
                    por Filme</button>
                <button onclick="handleApiCall('review-list-result', 'GET', '/reviews')">Listar Todas</button>
                <pre id="review-list-result"></pre>
            </div>
        </section>

        <section class="entity-column">
            <h2>Listas</h2>
            <div class="operation">
                <h3>Gerenciar Listas de Usuário</h3>
                <input id="lista-userId" type="number" placeholder="ID do Usuário">
                <button
                    onclick="handleApiCall('lista-user-result', 'POST', `/listas/user/${getValue('lista-userId')}/init-padrao`)">Criar
                    Listas Padrão</button>
                <input id="lista-nome" placeholder="Nome da Lista Personalizada">
                <button
                    onclick="handleApiCall('lista-user-result', 'POST', '/listas', { userId: parseInt(getValue('lista-userId')), nome: getValue('lista-nome'), padrao: false })">Criar
                    Lista Personalizada</button>
                <button
                    onclick="handleApiCall('lista-user-result', 'GET', `/listas/user/${getValue('lista-userId')}`)">Ver
                    Listas do Usuário</button>
                <button onclick="handleApiCall('lista-user-result', 'GET', '/listas')">Listar Todas as Listas</button>
                <pre id="lista-user-result"></pre>
            </div>
            <div class="operation">
                <h3>Gerenciar Filmes em Listas</h3>
                <input id="lista-id-rel" type="number" placeholder="ID da Lista">
                <input id="filme-id-rel" type="number" placeholder="ID do Filme">
                <button
                    onclick="handleApiCall('lista-rel-result', 'POST', `/listas/${getValue('lista-id-rel')}/filmes/${getValue('filme-id-rel')}`)">Adicionar
                    Filme</button>
                <button
                    onclick="handleApiCall('lista-rel-result', 'DELETE', `/listas/${getValue('lista-id-rel')}/filmes/${getValue('filme-id-rel')}`)">Remover
                    Filme</button>
                <pre id="lista-rel-result"></pre>
            </div>
            <div class="operation">
                <h3>Alterar / Excluir Lista</h3>
                <input id="lista-id-manage" type="number" placeholder="ID da Lista">
                <input id="lista-new-name" placeholder="Novo Nome (para alterar)">
                <button
                    onclick="handleApiCall('lista-manage-result', 'PUT', `/listas/${getValue('lista-id-manage')}`, { nome: getValue('lista-new-name') })">Alterar
                    Nome</button>
                <button
                    onclick="handleApiCall('lista-manage-result', 'DELETE', `/listas/${getValue('lista-id-manage')}`)">Excluir
                    Lista</button>
                <pre id="lista-manage-result"></pre>
            </div>
        </section>

    </main>

    <script>
        const API_BASE_URL = 'http://localhost:8080/api';

        function getValue(id) {
            return document.getElementById(id).value;
        }

        async function handleApiCall(resultDivId, method, endpoint, body = null, customHeaders = {}) {
            const resultDiv = document.getElementById(resultDivId);
            resultDiv.textContent = 'Executando...';
            resultDiv.className = '';

            try {
                const options = {
                    method: method,
                    headers: { 'Content-Type': 'application/json', ...customHeaders },
                };
                if (body) {
                    options.body = JSON.stringify(body);
                }

                const response = await fetch(`${API_BASE_URL}${endpoint}`, options);

                const contentType = response.headers.get("content-type");
                let responseData;

                if (response.status === 204) {
                    responseData = `Sucesso! (Status: 204 No Content)`;
                } else if (contentType && contentType.includes("application/json")) {
                    responseData = await response.json();
                } else {
                    responseData = await response.text();
                }

                if (!response.ok) {
                    let errorMessage = responseData;
                    if (typeof responseData === 'object' && responseData !== null && responseData.message) {
                        errorMessage = responseData.message;
                    } else if (typeof responseData === 'object') {
                        errorMessage = JSON.stringify(responseData);
                    }
                    throw new Error(`Status ${response.status}: ${errorMessage}`);
                }

                resultDiv.classList.add('success');
                if (typeof responseData === 'object') {
                    resultDiv.textContent = `Sucesso! (Status: ${response.status})\n\n${JSON.stringify(responseData, null, 2)}`;
                } else {
                    resultDiv.textContent = `Sucesso! (Status: ${response.status})\n\n${responseData}`;
                }

            } catch (error) {
                resultDiv.classList.add('error');
                resultDiv.textContent = `Falha:\n${error.toString()}`;
            }
        }

        function criarFilme() {
            const body = {
                title: getValue('filme-title'),
                releaseDate: getValue('filme-releaseDate'),
                score: parseInt(getValue('filme-score')) || 0,
                duration: parseInt(getValue('filme-duration')) || 0,
                rating: parseInt(getValue('filme-rating')) || 0,
                directors: getValue('filme-directors').split(',').map(s => s.trim()).filter(Boolean),
                actors: getValue('filme-actors').split(',').map(s => s.trim()).filter(Boolean)
            };
            handleApiCall('filme-create-result', 'POST', '/filmes', body);
        }

        function criarReview() {
            const body = {
                userId: parseInt(getValue('review-userId')),
                filmeId: parseInt(getValue('review-filmeId')),
                nota: parseFloat(getValue('review-nota')),
                comentario: getValue('review-comentario')
            };
            handleApiCall('review-create-result', 'POST', '/reviews', body);
        }

        function atualizarReview() {
            const reviewId = getValue('review-update-id');
            const userId = getValue('review-update-userId');
            if (!reviewId || !userId) {
                alert('Por favor, informe o ID da Review e o seu ID de Usuário para a permissão.');
                return;
            }
            const body = {
                nota: parseFloat(getValue('review-update-nota')),
                comentario: getValue('review-update-comentario')
            };
            const headers = {
                'X-User-ID': userId
            };
            handleApiCall('review-update-result', 'PUT', `/reviews/${reviewId}`, body, headers);
        }

    </script>
</body>

</html>